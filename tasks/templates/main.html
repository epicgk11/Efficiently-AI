<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <title>Task List</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
    <style>
        /* CSS for styling tags */
        .tag {
            display: inline-block;
            padding: 2px 6px;
            margin: 2px;
            border-radius: 4px;
            background-color: #007BFF; /* Default background color */
            color: #fff;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Task List</h1>
    <a href="{% url 'createtask' %}">Create New Task</a>

    <!-- Filtering Form -->
    <form method="get" action="{% url 'listtasks' %}">
        <input type="text" name="name" placeholder="Filter by Name" value="{{ request.GET.name }}">
        <input type="date" name="due_date" placeholder="Filter by Due Date" value="{{ request.GET.due_date }}">
        <input type="text" name="tags" placeholder="Filter by Tags (comma-separated)" value="{{ request.GET.tags }}">
        <select name="group_by">
            <option value="">-- Group By --</option>
            <option value="tags" {% if request.GET.group_by == 'tags' %}selected{% endif %}>Tags</option>
        </select>
        <button type="submit">Filter</button>
        <a href="{% url 'listtasks' %}">Clear Filters</a>
    </form>

    <div class="task-container">
        {% if group_by_tags %}
            {% for tag, tasks in grouped_tasks.items %}
                <h2>{{ tag }}</h2>
                {% for task in tasks %}
                <div class="task-box" data-task-id="{{ task.id }}">
                    <h3>{{ task.name }}</h3>
                    <p>{{ task.description }}</p>
                    <p>Due Date: {{ task.due_date }}</p>
                    <div class="tags">
                        {% for tag_name in task.tags %}
                        <span class="tag">{{ tag_name }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            {% endfor %}
        {% else %}
            {% for task in tasks %}
            <div class="task-box" data-task-id="{{ task.id }}">
                <h3>{{ task.name }}</h3>
                <p>{{ task.description }}</p>
                <p>Due Date: {{ task.due_date }}</p>
                <div class="tags">
                    {% for tag_name in task.tags %}
                    <span class="tag">{{ tag_name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <!-- Popup Overlay -->
    <div class="popup-overlay" id="popup-overlay">
        <div class="popup-content">
            <span class="close-popup" id="close-popup">&times;</span>
            <h2>Edit Task</h2>
            <form id="edit-task-form">
                {% csrf_token %}
                <input type="hidden" name="task_id" id="task-id" />
                <!-- Task Name -->
                <div class="form-group">
                    <label for="task-name">Name:</label>
                    <input type="text" name="name" id="task-name" required />
                </div>
                <!-- Description -->
                <div class="form-group">
                    <label for="task-description">Description:</label>
                    <textarea name="description" id="task-description" required></textarea>
                </div>
                <!-- Due Date -->
                <div class="form-group">
                    <label for="task-due-date">Due Date:</label>
                    <input type="date" name="due_date" id="task-due-date" />
                </div>
                <!-- Resources -->
                <div class="form-group">
                    <label for="task-resources">Resources:</label>
                    <input type="text" name="resources" id="task-resources" />
                </div>
                <!-- Completed -->
                <div class="form-group">
                    <label for="task-completed">Completed:</label>
                    <input type="checkbox" name="completed" id="task-completed" />
                </div>
                <!-- Tags -->
                <div class="form-group" id="tags-container">
                    <label>Tags:</label>
                    <div id="tags-list">
                        <!-- Tag inputs will be appended here -->
                    </div>
                    <button type="button" id="add-tag-btn">+ Add Tag</button>
                </div>
                <!-- Steps -->
                <div class="steps-container" id="steps-container">
                    <h3>Steps</h3>
                    <!-- Steps will be appended here -->
                </div>
                <button type="button" id="add-step-btn">+ Add Step</button>
                <br><br>
                <button type="submit">Save Changes</button>
            </form>
        </div>
    </div>
    <script src="{% static 'js/main.js' %}"></script>
</body>
</html>
